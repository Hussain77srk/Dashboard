<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة إدارة اجنحة المسافر للسفر والسياحة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, updateDoc, doc, query, orderBy, deleteDoc, addDoc, where } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase configuration (same as main app)
        const firebaseConfig = {
            apiKey: "AIzaSyAw0OGmGdtpK2JYE4rkYnKUMfmicEU_lKU",
            authDomain: "safar-529c4.firebaseapp.com",
            databaseURL: "https://safar-529c4-default-rtdb.firebaseio.com",
            projectId: "safar-529c4",
            storageBucket: "safar-529c4.firebasestorage.app",
            messagingSenderId: "296030548234",
            appId: "1:296030548234:web:34cb4cf8a4eqaabdc67b48af3",       
            measurementId: "Good"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.firebaseDB = db;
        window.firebaseCollection = collection;
        window.firebaseGetDocs = getDocs;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseDoc = doc;
        window.firebaseQuery = query;
        window.firebaseOrderBy = orderBy;
        window.firebaseDeleteDoc = deleteDoc;
        window.firebaseAddDoc = addDoc;
        window.firebaseWhere = where;
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#F8F9FA'
                    },
                    fontFamily: {
                        arabic: ['Tajawal', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap');
        body { font-family: 'Tajawal', Arial, sans-serif; }
        
        .hero-gradient {
            background: linear-gradient(135deg, #5D5CDE 0%, #4338CA 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Dark mode styles */
        .dark {
            --tw-bg-opacity: 1;
            background-color: rgb(24 24 24 / var(--tw-bg-opacity));
            color: white;
        }
        
        .status-pending { background-color: #FEF3C7; color: #92400E; }
        .status-confirmed { background-color: #D1FAE5; color: #065F46; }
        .status-cancelled { background-color: #FEE2E2; color: #991B1B; }
        
        .dark .status-pending { background-color: #451A03; color: #FCD34D; }
        .dark .status-confirmed { background-color: #064E3B; color: #6EE7B7; }
        .dark .status-cancelled { background-color: #7F1D1D; color: #FCA5A5; }

        .logo-container img {
            max-width: 60px;
            max-height: 60px;
            object-fit: contain;
        }

        .tab-button.active {
            background-color: #5D5CDE;
            color: white;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white transition-colors duration-300">
    
    <!-- Image Upload Modal -->
    <div id="image-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold">تحميل شعار الوكالة</h3>
                    <button onclick="closeImageModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">اختر صورة من جهازك</label>
                    <input type="file" id="image-upload" accept="image/*" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary">
                </div>
                <div class="text-center">
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">أو أدخل رابط الصورة</p>
                    <input type="url" id="image-url" placeholder="https://example.com/logo.jpg" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary mb-4">
                </div>
                <div class="flex gap-4">
                    <button onclick="applyImage()" class="flex-1 bg-primary text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                        تطبيق
                    </button>
                    <button onclick="closeImageModal()" class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors">
                        إلغاء
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Section -->
    <div id="login-section" class="min-h-screen hero-gradient flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <div class="logo-container relative group cursor-pointer mx-auto mb-4" onclick="openImageModal()">
                    <img id="login-logo" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiM1RDVDREUiLz4KPHN2ZyB4PSIyMCIgeT0iMjAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0iI0ZGRiI+CjxwYXRoIGQ9Ik0xMCA1TDE4IDEwTDEwIDE1VjEzSDJWN0gxMFY1WiIvPgo8L3N2Zz4KPC9zdmc+" alt="شعار الوكالة" class="mx-auto">
                    <div class="absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-full flex items-center justify-center">
                        <i class="fas fa-camera text-white text-sm"></i>
                    </div>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 dark:text-white">لوحة إدارة الوكالة</h1>
                <p class="text-gray-600 dark:text-gray-300 mt-2">تسجيل دخول الإدارة</p>
            </div>
            
            <form id="login-form">
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-900 dark:text-white">اسم المستخدم</label>
                    <input type="text" id="username" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary" required>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-900 dark:text-white">كلمة المرور</label>
                    <input type="password" id="password" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary" required>
                </div>
                
                <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors mb-4">
                    تسجيل الدخول
                </button>
                
                <div class="text-center">
                    <button type="button" onclick="showRegistration()" class="text-primary hover:underline">
                        ليس لديك حساب؟ إنشاء حساب جديد
                    </button>
                </div>
                
                <div id="login-error" class="hidden mt-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 text-red-700 dark:text-red-300 rounded-lg">
                    <i class="fas fa-exclamation-circle mr-2"></i>
                    <span>اسم المستخدم أو كلمة المرور غير صحيحة</span>
                </div>
            </form>
        </div>
    </div>

    <!-- Registration Section -->
    <div id="registration-section" class="hidden min-h-screen hero-gradient flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <img id="register-logo" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiM1RDVDREUiLz4KPHN2ZyB4PSIyMCIgeT0iMjAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0iI0ZGRiI+CjxwYXRoIGQ9Ik0xMCA1TDE4IDEwTDEwIDE1VjEzSDJWN0gxMFY1WiIvPgo8L3N2Zz4KPC9zdmc+" alt="شعار الوكالة" class="mx-auto mb-4">
                <h1 class="text-2xl font-bold text-gray-900 dark:text-white">إنشاء حساب جديد</h1>
                <p class="text-gray-600 dark:text-gray-300 mt-2">انضم لفريق إدارة الوكالة</p>
            </div>
            
            <form id="registration-form">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2 text-gray-900 dark:text-white">الاسم الكامل</label>
                    <input type="text" id="fullname" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2 text-gray-900 dark:text-white">اسم المستخدم</label>
                    <input type="text" id="new-username" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2 text-gray-900 dark:text-white">كلمة المرور</label>
                    <input type="password" id="new-password" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary" required>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-900 dark:text-white">تأكيد كلمة المرور</label>
                    <input type="password" id="confirm-password" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary" required>
                </div>
                
                <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors mb-4">
                    إنشاء الحساب
                </button>
                
                <div class="text-center">
                    <button type="button" onclick="showLogin()" class="text-primary hover:underline">
                        لديك حساب بالفعل؟ تسجيل دخول
                    </button>
                </div>
                
                <div id="registration-message" class="hidden mt-4 p-3 rounded-lg">
                    <i class="mr-2"></i>
                    <span></span>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-section" class="hidden">
        <!-- Navigation -->
        <nav class="bg-white dark:bg-gray-800 shadow-lg">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-reverse space-x-4">
                        <img id="nav-logo" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiM1RDVDREUiLz4KPHN2ZyB4PSIxMCIgeT0iMTAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0iI0ZGRiI+CjxwYXRoIGQ9Ik0xMCA1TDE4IDEwTDEwIDE1VjEzSDJWN0gxMFY1WiIvPgo8L3N2Zz4KPC9zdmc+" alt="شعار الوكالة" class="w-8 h-8">
                        <h1 class="text-xl font-bold text-primary">لوحة إدارة اجنحة المسافر للسفر والسياحة</h1>
                    </div>
                    <div class="flex items-center space-x-reverse space-x-4">
                        <span class="text-sm text-gray-600 dark:text-gray-300">مرحباً، <span id="current-user">مدير النظام</span></span>
                        <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i>
                            تسجيل خروج
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Dashboard Content -->
        <div class="container mx-auto px-4 py-8">
            <!-- Statistics Cards -->
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                    <div class="flex items-center">
                        <div class="bg-blue-100 dark:bg-blue-900 p-3 rounded-full">
                            <i class="fas fa-calendar-check text-blue-600 dark:text-blue-400 text-xl"></i>
                        </div>
                        <div class="mr-4">
                            <h3 class="text-2xl font-bold" id="total-bookings">0</h3>
                            <p class="text-gray-600 dark:text-gray-300">إجمالي الحجوزات</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                    <div class="flex items-center">
                        <div class="bg-yellow-100 dark:bg-yellow-900 p-3 rounded-full">
                            <i class="fas fa-clock text-yellow-600 dark:text-yellow-400 text-xl"></i>
                        </div>
                        <div class="mr-4">
                            <h3 class="text-2xl font-bold" id="pending-bookings">0</h3>
                            <p class="text-gray-600 dark:text-gray-300">حجوزات في الانتظار</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                    <div class="flex items-center">
                        <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                            <i class="fas fa-check-circle text-green-600 dark:text-green-400 text-xl"></i>
                        </div>
                        <div class="mr-4">
                            <h3 class="text-2xl font-bold" id="confirmed-bookings">0</h3>
                            <p class="text-gray-600 dark:text-gray-300">حجوزات مؤكدة</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                    <div class="flex items-center">
                        <div class="bg-purple-100 dark:bg-purple-900 p-3 rounded-full">
                            <i class="fas fa-users text-purple-600 dark:text-purple-400 text-xl"></i>
                        </div>
                        <div class="mr-4">
                            <h3 class="text-2xl font-bold" id="total-visits">0</h3>
                            <p class="text-gray-600 dark:text-gray-300">طلبات تأمين الزيارات</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg mb-6">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex flex-wrap gap-4">
                        <button onclick="showTab('bookings')" id="bookings-tab" class="tab-button active px-6 py-3 rounded-lg font-semibold transition-colors bg-gray-200 dark:bg-gray-700 hover:bg-primary hover:text-white">
                            <i class="fas fa-calendar-check mr-2"></i>
                            إدارة الحجوزات
                        </button>
                        <button onclick="showTab('visits')" id="visits-tab" class="tab-button px-6 py-3 rounded-lg font-semibold transition-colors bg-gray-200 dark:bg-gray-700 hover:bg-primary hover:text-white">
                            <i class="fas fa-users mr-2"></i>
                            طلبات تأمين الزيارات
                        </button>
                    </div>
                </div>

                <!-- Bookings Tab Content -->
                <div id="bookings-content" class="p-6">
                    <div class="flex flex-col lg:flex-row gap-4 justify-between items-start lg:items-center mb-6">
                        <h2 class="text-2xl font-bold">إدارة الحجوزات</h2>
                        <div class="flex flex-col sm:flex-row gap-4 w-full lg:w-auto">
                            <div class="relative flex-1 lg:w-80">
                                <input type="text" id="search-bookings" placeholder="البحث في الحجوزات..." class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary">
                                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                            </div>
                            <button onclick="loadBookings()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors whitespace-nowrap">
                                <i class="fas fa-sync-alt mr-2"></i>
                                تحديث
                            </button>
                        </div>
                    </div>

                    <div id="bookings-loading" class="text-center py-8">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"></div>
                        <p class="mt-4 text-gray-600 dark:text-gray-300">جارٍ تحميل الحجوزات...</p>
                    </div>

                    <div id="bookings-container" class="hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200 dark:border-gray-700">
                                        <th class="text-right py-3 px-4 font-semibold">اسم العميل</th>
                                        <th class="text-right py-3 px-4 font-semibold">الوجهة</th>
                                        <th class="text-right py-3 px-4 font-semibold">من - إلى</th>
                                        <th class="text-right py-3 px-4 font-semibold">تاريخ المغادرة</th>
                                        <th class="text-right py-3 px-4 font-semibold">عدد المسافرين</th>
                                        <th class="text-right py-3 px-4 font-semibold">الحالة</th>
                                        <th class="text-right py-3 px-4 font-semibold">الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="bookings-table-body">
                                    <!-- Bookings will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="no-bookings" class="hidden text-center py-8">
                        <i class="fas fa-inbox text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 dark:text-gray-300">لا توجد حجوزات بعد</p>
                    </div>
                </div>

                <!-- Visits Tab Content -->
                <div id="visits-content" class="p-6 hidden">
                    <div class="flex flex-col lg:flex-row gap-4 justify-between items-start lg:items-center mb-6">
                        <h2 class="text-2xl font-bold">طلبات تأمين الزيارات العائلية</h2>
                        <div class="flex flex-col sm:flex-row gap-4 w-full lg:w-auto">
                            <div class="relative flex-1 lg:w-80">
                                <input type="text" id="search-visits" placeholder="البحث في طلبات الزيارات..." class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary">
                                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                            </div>
                            <button onclick="loadVisits()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors whitespace-nowrap">
                                <i class="fas fa-sync-alt mr-2"></i>
                                تحديث
                            </button>
                        </div>
                    </div>

                    <div id="visits-loading" class="text-center py-8">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"></div>
                        <p class="mt-4 text-gray-600 dark:text-gray-300">جارٍ تحميل طلبات الزيارات...</p>
                    </div>

                    <div id="visits-container" class="hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200 dark:border-gray-700">
                                        <th class="text-right py-3 px-4 font-semibold">اسم العميل</th>
                                        <th class="text-right py-3 px-4 font-semibold">رقم التأشيرة</th>
                                        <th class="text-right py-3 px-4 font-semibold">رقم الجواز</th>
                                        <th class="text-right py-3 px-4 font-semibold">تاريخ الانتهاء</th>
                                        <th class="text-right py-3 px-4 font-semibold">الحالة</th>
                                        <th class="text-right py-3 px-4 font-semibold">الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="visits-table-body">
                                    <!-- Visits will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="no-visits" class="hidden text-center py-8">
                        <i class="fas fa-inbox text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 dark:text-gray-300">لا توجد طلبات زيارات بعد</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Section -->
        <section class="py-20 bg-gray-50 dark:bg-gray-800">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold mb-4">تواصل معنا</h2>
                    <p class="text-gray-600 dark:text-gray-300 text-lg">نحن هنا لخدمتك في أي وقت</p>
                </div>

                <div class="grid md:grid-cols-2 gap-8 max-w-2xl mx-auto">
                    <!-- Contact Cards -->
                    <div class="text-center p-6">
                        <div class="bg-primary text-white w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-phone text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">الهاتف</h3>
                        <a href="tel:+249912626128" class="block text-gray-600 dark:text-gray-300 hover:text-primary transition-colors mb-1">+249912626128</a>
                        <a href="tel:+249126126242" class="block text-gray-600 dark:text-gray-300 hover:text-primary transition-colors mb-1">+249126126242</a>
                        <a href="tel:+966560228334" class="block text-gray-600 dark:text-gray-300 hover:text-primary transition-colors">+966560228334</a>
                    </div>

                    <div class="text-center p-6">
                        <div class="bg-primary text-white w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-envelope text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">البريد الإلكتروني</h3>
                        <a href="mailto:travelerwings.sd@gmail.com" class="block text-gray-600 dark:text-gray-300 hover:text-primary transition-colors">travelerwings.sd@gmail.com</a>
                    </div>
                </div>

                <!-- Social Media -->
                <div class="mt-16 text-center">
                    <h3 class="text-2xl font-bold mb-8">تابعنا على وسائل التواصل</h3>
                    <div class="flex justify-center space-x-reverse space-x-6">
                        <a href="https://www.facebook.com/share/1CRiVyh6uA/?mibextid=wwXIfr" target="_blank" class="bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center hover:bg-blue-700 transition-colors">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://wa.me/249912626128" target="_blank" class="bg-green-600 text-white w-12 h-12 rounded-full flex items-center justify-center hover:bg-green-700 transition-colors">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                        <a href="#" class="bg-black text-white w-12 h-12 rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors">
                            <i class="fab fa-tiktok"></i>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-gray-800 dark:bg-gray-900 text-white py-12">
            <div class="container mx-auto px-4">
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <div class="flex items-center space-x-reverse space-x-4 mb-4">
                            <img id="footer-logo" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiM1RDVDREUiLz4KPHN2ZyB4PSIxMCIgeT0iMTAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0iI0ZGRiI+CjxwYXRoIGQ9Ik0xMCA1TDE4IDEwTDEwIDE1VjEzSDJWN0gxMFY1WiIvPgo8L3N2Zz4KPC9zdmc+" alt="شعار الوكالة" class="w-8 h-8">
                            <h3 class="text-xl font-bold">اجنحة المسافر للسفر والسياحة</h3>
                        </div>
                        <p class="text-gray-400">نحن وكالة سفر رائدة نقدم أفضل الخدمات السياحية لعملائنا الكرام</p>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-semibold mb-4">روابط سريعة</h4>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-400 hover:text-white transition-colors">لوحة الإدارة</a></li>
                            <li><a href="#" onclick="showTab('bookings')" class="text-gray-400 hover:text-white transition-colors cursor-pointer">الحجوزات</a></li>
                            <li><a href="#" onclick="showTab('visits')" class="text-gray-400 hover:text-white transition-colors cursor-pointer">طلبات الزيارات</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="border-t border-gray-700 mt-8 pt-8 text-center">
                    <p class="text-gray-400">&copy; 2024 اجنحة المسافر للسفر والسياحة. جميع الحقوق محفوظة.</p>
                    <p class="text-gray-500 text-sm mt-2">تم التصميم من قبل المهندس حسين نقد</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Booking Details Modal -->
    <div id="booking-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-96 overflow-y-auto">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h3 class="text-2xl font-bold">تفاصيل الحجز</h3>
                    <button onclick="closeModal('booking')" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div id="booking-details" class="p-6">
                <!-- Booking details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Visit Details Modal -->
    <div id="visit-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-96 overflow-y-auto">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h3 class="text-2xl font-bold">تفاصيل طلب تأمين الزيارة</h3>
                    <button onclick="closeModal('visit')" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div id="visit-details" class="p-6">
                <!-- Visit details will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Global variables
        let currentUser = '';
        let allBookings = [];
        let filteredBookings = [];
        let allVisits = [];
        let filteredVisits = [];
        let currentTab = 'bookings';

        // Tab management
        function showTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Show/hide content
            document.getElementById('bookings-content').classList.toggle('hidden', tabName !== 'bookings');
            document.getElementById('visits-content').classList.toggle('hidden', tabName !== 'visits');
            
            // Load data for the active tab
            if (tabName === 'bookings') {
                loadBookings();
            } else if (tabName === 'visits') {
                loadVisits();
            }
        }

        // Image modal functions
        function openImageModal() {
            document.getElementById('image-modal').classList.remove('hidden');
            document.getElementById('image-upload').value = '';
            document.getElementById('image-url').value = '';
        }

        function closeImageModal() {
            document.getElementById('image-modal').classList.add('hidden');
        }

        function applyImage() {
            const fileInput = document.getElementById('image-upload');
            const urlInput = document.getElementById('image-url');
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    updateLogo(e.target.result);
                };
                reader.readAsDataURL(file);
            } else if (urlInput.value.trim()) {
                updateLogo(urlInput.value.trim());
            }
        }

        function updateLogo(imageSrc) {
            document.getElementById('login-logo').src = imageSrc;
            document.getElementById('register-logo').src = imageSrc;
            document.getElementById('nav-logo').src = imageSrc;
            document.getElementById('footer-logo').src = imageSrc;
            closeImageModal();
        }

        // Authentication functions
        function showRegistration() {
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('registration-section').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('registration-section').classList.add('hidden');
            document.getElementById('login-section').classList.remove('hidden');
        }

        // Login functionality
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Check default admin credentials
            if (username === 'admin' && password === 'admin123') {
                currentUser = 'مدير النظام';
                document.getElementById('current-user').textContent = currentUser;
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('admin-section').classList.remove('hidden');
                showTab('bookings');
                return;
            }
            
            // Check Firebase for custom accounts
            try {
                if (window.firebaseDB) {
                    const usersRef = window.firebaseCollection(window.firebaseDB, 'users');
                    const q = window.firebaseQuery(usersRef, window.firebaseWhere('username', '==', username));
                    const querySnapshot = await window.firebaseGetDocs(q);
                    
                    let userFound = false;
                    querySnapshot.forEach((doc) => {
                        const userData = doc.data();
                        if (userData.password === password) {
                            currentUser = userData.fullname;
                            document.getElementById('current-user').textContent = currentUser;
                            document.getElementById('login-section').classList.add('hidden');
                            document.getElementById('admin-section').classList.remove('hidden');
                            showTab('bookings');
                            userFound = true;
                        }
                    });
                    
                    if (!userFound) {
                        document.getElementById('login-error').classList.remove('hidden');
                        setTimeout(() => {
                            document.getElementById('login-error').classList.add('hidden');
                        }, 3000);
                    }
                }
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('login-error').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('login-error').classList.add('hidden');
                }, 3000);
            }
        });

        // Registration functionality
        document.getElementById('registration-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const fullname = document.getElementById('fullname').value;
            const username = document.getElementById('new-username').value;
            const password = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (password !== confirmPassword) {
                showMessage('كلمات المرور غير متطابقة', 'error');
                return;
            }
            
            try {
                if (window.firebaseDB) {
                    // Check if username already exists
                    const usersRef = window.firebaseCollection(window.firebaseDB, 'users');
                    const q = window.firebaseQuery(usersRef, window.firebaseWhere('username', '==', username));
                    const querySnapshot = await window.firebaseGetDocs(q);
                    
                    if (!querySnapshot.empty) {
                        showMessage('اسم المستخدم موجود بالفعل', 'error');
                        return;
                    }
                    
                    // Create new user
                    await window.firebaseAddDoc(usersRef, {
                        fullname: fullname,
                        username: username,
                        password: password,
                        createdAt: new Date()
                    });
                    
                    showMessage('تم إنشاء الحساب بنجاح! يمكنك الآن تسجيل الدخول', 'success');
                    
                    setTimeout(() => {
                        showLogin();
                    }, 2000);
                }
            } catch (error) {
                console.error('Registration error:', error);
                showMessage('حدث خطأ في إنشاء الحساب', 'error');
            }
        });

        function showMessage(message, type) {
            const messageDiv = document.getElementById('registration-message');
            const icon = messageDiv.querySelector('i');
            const span = messageDiv.querySelector('span');
            
            span.textContent = message;
            messageDiv.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'text-green-700', 'text-red-700', 'border-green-400', 'border-red-400');
            icon.classList.remove('fas', 'fa-check-circle', 'fa-exclamation-circle');
            
            if (type === 'success') {
                messageDiv.classList.add('bg-green-100', 'text-green-700', 'border-green-400');
                icon.classList.add('fas', 'fa-check-circle');
            } else {
                messageDiv.classList.add('bg-red-100', 'text-red-700', 'border-red-400');
                icon.classList.add('fas', 'fa-exclamation-circle');
            }
            
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }

        // Logout functionality
        function logout() {
            document.getElementById('admin-section').classList.add('hidden');
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            currentUser = '';
        }

        // Search functionality for bookings
        document.getElementById('search-bookings').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            if (searchTerm === '') {
                filteredBookings = [...allBookings];
            } else {
                filteredBookings = allBookings.filter(booking => 
                    booking.fullName.toLowerCase().includes(searchTerm) ||
                    booking.destination.toLowerCase().includes(searchTerm) ||
                    booking.phone.includes(searchTerm) ||
                    booking.email.toLowerCase().includes(searchTerm) ||
                    (booking.departureCountry && booking.departureCountry.toLowerCase().includes(searchTerm)) ||
                    (booking.arrivalCountry && booking.arrivalCountry.toLowerCase().includes(searchTerm))
                );
            }
            
            displayBookings(filteredBookings);
        });

        // Search functionality for visits
        document.getElementById('search-visits').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            if (searchTerm === '') {
                filteredVisits = [...allVisits];
            } else {
                filteredVisits = allVisits.filter(visit => 
                    visit.fullName.toLowerCase().includes(searchTerm) ||
                    visit.phone.includes(searchTerm) ||
                    visit.email.toLowerCase().includes(searchTerm) ||
                    visit.visaNumber.includes(searchTerm) ||
                    visit.passportNumber.includes(searchTerm)
                );
            }
            
            displayVisits(filteredVisits);
        });

        // Load bookings from Firebase
        async function loadBookings() {
            try {
                document.getElementById('bookings-loading').classList.remove('hidden');
                document.getElementById('bookings-container').classList.add('hidden');
                document.getElementById('no-bookings').classList.add('hidden');

                if (!window.firebaseDB) {
                    throw new Error('Firebase not initialized');
                }

                const bookingsRef = window.firebaseCollection(window.firebaseDB, 'bookings');
                const q = window.firebaseQuery(bookingsRef, window.firebaseOrderBy('timestamp', 'desc'));
                const querySnapshot = await window.firebaseGetDocs(q);
                
                allBookings = [];
                querySnapshot.forEach((doc) => {
                    allBookings.push({ id: doc.id, ...doc.data() });
                });

                filteredBookings = [...allBookings];
                document.getElementById('bookings-loading').classList.add('hidden');
                
                if (allBookings.length === 0) {
                    document.getElementById('no-bookings').classList.remove('hidden');
                    return;
                }

                // Update statistics
                updateStatistics();
                
                // Display bookings
                displayBookings(filteredBookings);
                document.getElementById('bookings-container').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error loading bookings:', error);
                document.getElementById('bookings-loading').classList.add('hidden');
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'text-center py-8';
                errorDiv.innerHTML = `
                    <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                    <p class="text-red-600 dark:text-red-400">حدث خطأ في تحميل الحجوزات</p>
                `;
                
                const container = document.getElementById('bookings-container');
                container.innerHTML = '';
                container.appendChild(errorDiv);
                container.classList.remove('hidden');
            }
        }

        // Load visits from Firebase
        async function loadVisits() {
            try {
                document.getElementById('visits-loading').classList.remove('hidden');
                document.getElementById('visits-container').classList.add('hidden');
                document.getElementById('no-visits').classList.add('hidden');

                if (!window.firebaseDB) {
                    throw new Error('Firebase not initialized');
                }

                const visitsRef = window.firebaseCollection(window.firebaseDB, 'visits');
                const q = window.firebaseQuery(visitsRef, window.firebaseOrderBy('timestamp', 'desc'));
                const querySnapshot = await window.firebaseGetDocs(q);
                
                allVisits = [];
                querySnapshot.forEach((doc) => {
                    allVisits.push({ id: doc.id, ...doc.data() });
                });

                filteredVisits = [...allVisits];
                document.getElementById('visits-loading').classList.add('hidden');
                
                if (allVisits.length === 0) {
                    document.getElementById('no-visits').classList.remove('hidden');
                    return;
                }

                // Update statistics
                updateStatistics();
                
                // Display visits
                displayVisits(filteredVisits);
                document.getElementById('visits-container').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error loading visits:', error);
                document.getElementById('visits-loading').classList.add('hidden');
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'text-center py-8';
                errorDiv.innerHTML = `
                    <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                    <p class="text-red-600 dark:text-red-400">حدث خطأ في تحميل طلبات الزيارات</p>
                `;
                
                const container = document.getElementById('visits-container');
                container.innerHTML = '';
                container.appendChild(errorDiv);
                container.classList.remove('hidden');
            }
        }

        function updateStatistics() {
            const totalBookings = allBookings.length;
            const pendingBookings = allBookings.filter(b => b.status === 'pending').length;
            const confirmedBookings = allBookings.filter(b => b.status === 'confirmed').length;
            const totalVisits = allVisits.length;

            document.getElementById('total-bookings').textContent = totalBookings;
            document.getElementById('pending-bookings').textContent = pendingBookings;
            document.getElementById('confirmed-bookings').textContent = confirmedBookings;
            document.getElementById('total-visits').textContent = totalVisits;
        }

        function displayBookings(bookings) {
            const tableBody = document.getElementById('bookings-table-body');
            tableBody.innerHTML = '';

            if (bookings.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" class="text-center py-8 text-gray-500">
                        <i class="fas fa-search text-2xl mb-2"></i>
                        <p>لا توجد نتائج للبحث المطلوب</p>
                    </td>
                `;
                tableBody.appendChild(row);
                return;
            }

            bookings.forEach(booking => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700';
                
                const statusClass = `status-${booking.status || 'pending'}`;
                const statusText = {
                    pending: 'في الانتظار',
                    confirmed: 'مؤكد',
                    cancelled: 'ملغي'
                };

                const countryInfo = booking.departureCountry && booking.arrivalCountry ? 
                    `${booking.departureCountry} - ${booking.arrivalCountry}` : 'غير محدد';

                row.innerHTML = `
                    <td class="py-3 px-4">${booking.fullName}</td>
                    <td class="py-3 px-4">${booking.destination}</td>
                    <td class="py-3 px-4 text-sm">${countryInfo}</td>
                    <td class="py-3 px-4">${booking.departureDate}</td>
                    <td class="py-3 px-4">${booking.travelers}</td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusClass}">
                            ${statusText[booking.status] || 'في الانتظار'}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-reverse space-x-1 flex-wrap gap-1">
                            <button onclick="viewBooking('${booking.id}')" class="bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700 transition-colors text-xs">
                                <i class="fas fa-eye mr-1"></i>
                                عرض
                            </button>
                            ${booking.status === 'pending' ? `
                                <button onclick="updateBookingStatus('${booking.id}', 'confirmed')" class="bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700 transition-colors text-xs">
                                    <i class="fas fa-check mr-1"></i>
                                    تأكيد
                                </button>
                            ` : ''}
                            ${booking.status !== 'cancelled' ? `
                                <button onclick="updateBookingStatus('${booking.id}', 'cancelled')" class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700 transition-colors text-xs">
                                    <i class="fas fa-times mr-1"></i>
                                    إلغاء
                                </button>
                            ` : ''}
                            <button onclick="deleteBooking('${booking.id}')" class="bg-gray-800 text-white px-2 py-1 rounded hover:bg-gray-900 transition-colors text-xs">
                                <i class="fas fa-trash mr-1"></i>
                                حذف
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function displayVisits(visits) {
            const tableBody = document.getElementById('visits-table-body');
            tableBody.innerHTML = '';

            if (visits.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" class="text-center py-8 text-gray-500">
                        <i class="fas fa-search text-2xl mb-2"></i>
                        <p>لا توجد نتائج للبحث المطلوب</p>
                    </td>
                `;
                tableBody.appendChild(row);
                return;
            }

            visits.forEach(visit => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700';
                
                const statusClass = `status-${visit.status || 'pending'}`;
                const statusText = {
                    pending: 'في الانتظار',
                    confirmed: 'مؤكد',
                    cancelled: 'ملغي'
                };

                row.innerHTML = `
                    <td class="py-3 px-4">${visit.fullName}</td>
                    <td class="py-3 px-4">${visit.visaNumber}</td>
                    <td class="py-3 px-4">${visit.passportNumber}</td>
                    <td class="py-3 px-4">${visit.visaExpiry}</td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusClass}">
                            ${statusText[visit.status] || 'في الانتظار'}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-reverse space-x-1 flex-wrap gap-1">
                            <button onclick="viewVisit('${visit.id}')" class="bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700 transition-colors text-xs">
                                <i class="fas fa-eye mr-1"></i>
                                عرض
                            </button>
                            ${visit.status === 'pending' ? `
                                <button onclick="updateVisitStatus('${visit.id}', 'confirmed')" class="bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700 transition-colors text-xs">
                                    <i class="fas fa-check mr-1"></i>
                                    تأكيد
                                </button>
                            ` : ''}
                            ${visit.status !== 'cancelled' ? `
                                <button onclick="updateVisitStatus('${visit.id}', 'cancelled')" class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700 transition-colors text-xs">
                                    <i class="fas fa-times mr-1"></i>
                                    إلغاء
                                </button>
                            ` : ''}
                            <button onclick="deleteVisit('${visit.id}')" class="bg-gray-800 text-white px-2 py-1 rounded hover:bg-gray-900 transition-colors text-xs">
                                <i class="fas fa-trash mr-1"></i>
                                حذف
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Update booking status
        async function updateBookingStatus(bookingId, newStatus) {
            try {
                if (!window.firebaseDB) {
                    throw new Error('Firebase not initialized');
                }

                const bookingRef = window.firebaseDoc(window.firebaseDB, 'bookings', bookingId);
                await window.firebaseUpdateDoc(bookingRef, {
                    status: newStatus
                });

                // Update local data
                const bookingIndex = allBookings.findIndex(b => b.id === bookingId);
                if (bookingIndex !== -1) {
                    allBookings[bookingIndex].status = newStatus;
                    filteredBookings = allBookings.filter(booking => 
                        booking.fullName.toLowerCase().includes(document.getElementById('search-bookings').value.toLowerCase()) ||
                        booking.destination.toLowerCase().includes(document.getElementById('search-bookings').value.toLowerCase()) ||
                        booking.phone.includes(document.getElementById('search-bookings').value) ||
                        booking.email.toLowerCase().includes(document.getElementById('search-bookings').value.toLowerCase()) ||
                        document.getElementById('search-bookings').value === ''
                    );
                    updateStatistics();
                    displayBookings(filteredBookings);
                }
                
                showStatusMessage('تم تحديث حالة الحجز بنجاح', 'success');
                
            } catch (error) {
                console.error('Error updating booking:', error);
                showStatusMessage('حدث خطأ في تحديث الحجز', 'error');
            }
        }

        // Update visit status
        async function updateVisitStatus(visitId, newStatus) {
            try {
                if (!window.firebaseDB) {
                    throw new Error('Firebase not initialized');
                }

                const visitRef = window.firebaseDoc(window.firebaseDB, 'visits', visitId);
                await window.firebaseUpdateDoc(visitRef, {
                    status: newStatus
                });

                // Update local data
                const visitIndex = allVisits.findIndex(v => v.id === visitId);
                if (visitIndex !== -1) {
                    allVisits[visitIndex].status = newStatus;
                    filteredVisits = allVisits.filter(visit => 
                        visit.fullName.toLowerCase().includes(document.getElementById('search-visits').value.toLowerCase()) ||
                        visit.phone.includes(document.getElementById('search-visits').value) ||
                        visit.email.toLowerCase().includes(document.getElementById('search-visits').value.toLowerCase()) ||
                        document.getElementById('search-visits').value === ''
                    );
                    updateStatistics();
                    displayVisits(filteredVisits);
                }
                
                showStatusMessage('تم تحديث حالة طلب الزيارة بنجاح', 'success');
                
            } catch (error) {
                console.error('Error updating visit:', error);
                showStatusMessage('حدث خطأ في تحديث طلب الزيارة', 'error');
            }
        }

        // Delete booking
        async function deleteBooking(bookingId) {
            if (!confirm('هل أنت متأكد من حذف هذا الحجز؟ لا يمكن التراجع عن هذا الإجراء.')) {
                return;
            }
            
            try {
                if (!window.firebaseDB) {
                    throw new Error('Firebase not initialized');
                }

                const bookingRef = window.firebaseDoc(window.firebaseDB, 'bookings', bookingId);
                await window.firebaseDeleteDoc(bookingRef);

                // Update local data
                allBookings = allBookings.filter(b => b.id !== bookingId);
                filteredBookings = filteredBookings.filter(b => b.id !== bookingId);
                
                updateStatistics();
                displayBookings(filteredBookings);
                
                showStatusMessage('تم حذف الحجز بنجاح', 'success');
                
            } catch (error) {
                console.error('Error deleting booking:', error);
                showStatusMessage('حدث خطأ في حذف الحجز', 'error');
            }
        }

        // Delete visit
        async function deleteVisit(visitId) {
            if (!confirm('هل أنت متأكد من حذف طلب الزيارة هذا؟ لا يمكن التراجع عن هذا الإجراء.')) {
                return;
            }
            
            try {
                if (!window.firebaseDB) {
                    throw new Error('Firebase not initialized');
                }

                const visitRef = window.firebaseDoc(window.firebaseDB, 'visits', visitId);
                await window.firebaseDeleteDoc(visitRef);

                // Update local data
                allVisits = allVisits.filter(v => v.id !== visitId);
                filteredVisits = filteredVisits.filter(v => v.id !== visitId);
                
                updateStatistics();
                displayVisits(filteredVisits);
                
                showStatusMessage('تم حذف طلب الزيارة بنجاح', 'success');
                
            } catch (error) {
                console.error('Error deleting visit:', error);
                showStatusMessage('حدث خطأ في حذف طلب الزيارة', 'error');
            }
        }

        // View booking details
        function viewBooking(bookingId) {
            const booking = allBookings.find(b => b.id === bookingId);
            if (!booking) return;

            const statusText = {
                pending: 'في الانتظار',
                confirmed: 'مؤكد',
                cancelled: 'ملغي'
            };

            const tripTypeText = {
                economy: 'اقتصادية',
                business: 'رجال أعمال',
                first: 'درجة أولى'
            };

            const detailsContainer = document.getElementById('booking-details');
            detailsContainer.innerHTML = `
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">معلومات العميل</h4>
                        <div class="space-y-2">
                            <p><span class="font-medium">الاسم:</span> ${booking.fullName}</p>
                            <p><span class="font-medium">الهاتف:</span> ${booking.phone}</p>
                            <p><span class="font-medium">البريد الإلكتروني:</span> ${booking.email}</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">تفاصيل الرحلة</h4>
                        <div class="space-y-2">
                            <p><span class="font-medium">بلد المغادرة:</span> ${booking.departureCountry || 'غير محدد'}</p>
                            <p><span class="font-medium">بلد الوصول:</span> ${booking.arrivalCountry || 'غير محدد'}</p>
                            <p><span class="font-medium">الوجهة:</span> ${booking.destination}</p>
                            <p><span class="font-medium">تاريخ المغادرة:</span> ${booking.departureDate}</p>
                            <p><span class="font-medium">تاريخ العودة:</span> ${booking.returnDate}</p>
                            <p><span class="font-medium">عدد المسافرين:</span> ${booking.travelers}</p>
                            <p><span class="font-medium">نوع الرحلة:</span> ${tripTypeText[booking.tripType] || booking.tripType}</p>
                        </div>
                    </div>
                </div>
                
                ${booking.notes ? `
                    <div class="mt-6">
                        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">ملاحظات إضافية</h4>
                        <p class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">${booking.notes}</p>
                    </div>
                ` : ''}
                
                <div class="mt-6 flex justify-between items-center">
                    <div class="flex items-center space-x-reverse space-x-4">
                        <span class="font-medium">الحالة:</span>
                        <span class="px-3 py-1 rounded-full text-sm font-semibold status-${booking.status || 'pending'}">
                            ${statusText[booking.status] || 'في الانتظار'}
                        </span>
                    </div>
                    
                    <div class="flex space-x-reverse space-x-2">
                        ${booking.status === 'pending' ? `
                            <button onclick="updateBookingStatus('${booking.id}', 'confirmed'); closeModal('booking');" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                                <i class="fas fa-check mr-1"></i>
                                تأكيد الحجز
                            </button>
                        ` : ''}
                        ${booking.status !== 'cancelled' ? `
                            <button onclick="updateBookingStatus('${booking.id}', 'cancelled'); closeModal('booking');" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors">
                                <i class="fas fa-times mr-1"></i>
                                إلغاء الحجز
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;

            document.getElementById('booking-modal').classList.remove('hidden');
        }

        // View visit details
        function viewVisit(visitId) {
            const visit = allVisits.find(v => v.id === visitId);
            if (!visit) return;

            const statusText = {
                pending: 'في الانتظار',
                confirmed: 'مؤكد',
                cancelled: 'ملغي'
            };

            const detailsContainer = document.getElementById('visit-details');
            detailsContainer.innerHTML = `
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">معلومات العميل</h4>
                        <div class="space-y-2">
                            <p><span class="font-medium">الاسم:</span> ${visit.fullName}</p>
                            <p><span class="font-medium">الهاتف:</span> ${visit.phone}</p>
                            <p><span class="font-medium">البريد الإلكتروني:</span> ${visit.email}</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">بيانات التأشيرة والجواز</h4>
                        <div class="space-y-2">
                            <p><span class="font-medium">رقم التأشيرة:</span> ${visit.visaNumber}</p>
                            <p><span class="font-medium">رقم الحدود:</span> ${visit.borderNumber}</p>
                            <p><span class="font-medium">رقم الجواز:</span> ${visit.passportNumber}</p>
                            <p><span class="font-medium">تاريخ انتهاء التأشيرة:</span> ${visit.visaExpiry}</p>
                        </div>
                    </div>
                </div>
                
                ${visit.notes ? `
                    <div class="mt-6">
                        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">ملاحظات إضافية</h4>
                        <p class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">${visit.notes}</p>
                    </div>
                ` : ''}
                
                <div class="mt-6 flex justify-between items-center">
                    <div class="flex items-center space-x-reverse space-x-4">
                        <span class="font-medium">الحالة:</span>
                        <span class="px-3 py-1 rounded-full text-sm font-semibold status-${visit.status || 'pending'}">
                            ${statusText[visit.status] || 'في الانتظار'}
                        </span>
                    </div>
                    
                    <div class="flex space-x-reverse space-x-2">
                        ${visit.status === 'pending' ? `
                            <button onclick="updateVisitStatus('${visit.id}', 'confirmed'); closeModal('visit');" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                                <i class="fas fa-check mr-1"></i>
                                تأكيد الطلب
                            </button>
                        ` : ''}
                        ${visit.status !== 'cancelled' ? `
                            <button onclick="updateVisitStatus('${visit.id}', 'cancelled'); closeModal('visit');" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors">
                                <i class="fas fa-times mr-1"></i>
                                إلغاء الطلب
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;

            document.getElementById('visit-modal').classList.remove('hidden');
        }

        // Close modal
        function closeModal(type) {
            if (type === 'booking') {
                document.getElementById('booking-modal').classList.add('hidden');
            } else if (type === 'visit') {
                document.getElementById('visit-modal').classList.add('hidden');
            }
        }

        // Close modal on outside click
        document.getElementById('booking-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal('booking');
            }
        });

        document.getElementById('visit-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal('visit');
            }
        });

        function showStatusMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 left-1/2 transform -translate-x-1/2 px-4 py-3 rounded-lg z-50 ${
                type === 'success' 
                    ? 'bg-green-100 dark:bg-green-800 border border-green-400 text-green-700 dark:text-green-200' 
                    : 'bg-red-100 dark:bg-red-800 border border-red-400 text-red-700 dark:text-red-200'
            }`;
            messageDiv.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2"></i>
                ${message}
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
    </script>
</body>
</html>
